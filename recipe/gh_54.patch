From c112bafd97b8c8c2b4d86279ffed0a2d59dc7e02 Mon Sep 17 00:00:00 2001
From: xoviat <xoviat@users.noreply.github.com>
Date: Thu, 11 Jan 2018 23:45:33 -0600
Subject: [PATCH 1/5] CMake: remove shared library logic

---
 CMakeLists.txt | 10 ----------
 1 file changed, 10 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 504e4a0..93ef7d9 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -181,16 +181,6 @@ MACRO(REMOVE_MATCHING_FILES_FROM_LIST match_expr lst_files)
 	SET(${lst_files} ${lst_files_aux})
 ENDMACRO(REMOVE_MATCHING_FILES_FROM_LIST)
 
-
-## check if the SHARED variable has already been defined (by the metis project) and use it for our projects
-## BUILD_SHARED_LIBS specific variable allow cmake to know what kind of lib (STATIC or SHARED) it have to build
-if(DEFINED SHARED)
-	set(BUILD_SHARED_LIBS ${SHARED})
-else()
-	set(SHARED FALSE CACHE BOOL "Build shared libraries (.dll/.so) instead of static ones (.lib/.a)")
-	set(BUILD_SHARED_LIBS OFF)
-endif()
-
 if(WITH_CUDA)
 	FIND_PACKAGE(cuda)
 	IF(${CUDA_FOUND})

From 2178e87b19e4a3389d36cbddedd561687a4f8e47 Mon Sep 17 00:00:00 2001
From: xoviat <xoviat@users.noreply.github.com>
Date: Thu, 11 Jan 2018 23:48:20 -0600
Subject: [PATCH 2/5] CMake: renamed SHARED to BUILD_SHARED_LIBS

---
 metis/CMakeLists.txt | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/metis/CMakeLists.txt b/metis/CMakeLists.txt
index 186a320..a481485 100644
--- a/metis/CMakeLists.txt
+++ b/metis/CMakeLists.txt
@@ -2,7 +2,7 @@ cmake_minimum_required(VERSION 2.8)
 project(METIS)
 
 set(GKLIB_PATH "GKlib" CACHE PATH "path to GKlib")
-set(SHARED FALSE CACHE BOOL "build a shared library")
+set(BUILD_SHARED_LIBS FALSE CACHE BOOL "build a shared library")
 
 if(MSVC)
   set(METIS_INSTALL FALSE)
@@ -11,7 +11,7 @@ else()
 endif()
 
 # Configure libmetis library.
-if(SHARED)
+if(BUILD_SHARED_LIBS)
   set(METIS_LIBRARY_TYPE SHARED)
 else()
   set(METIS_LIBRARY_TYPE STATIC)

From 0bf7cfe572afc5ac232ccbf724307a2ea5c0790b Mon Sep 17 00:00:00 2001
From: xoviat <xoviat@users.noreply.github.com>
Date: Fri, 12 Jan 2018 11:21:56 -0600
Subject: [PATCH 3/5] Always build config statically

---
 SuiteSparse/SuiteSparse_config/CMakeLists.txt | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/SuiteSparse/SuiteSparse_config/CMakeLists.txt b/SuiteSparse/SuiteSparse_config/CMakeLists.txt
index 9edced6..167083a 100644
--- a/SuiteSparse/SuiteSparse_config/CMakeLists.txt
+++ b/SuiteSparse/SuiteSparse_config/CMakeLists.txt
@@ -2,7 +2,7 @@ PROJECT(suitesparseconfig)
 
 include_directories("${suitesparseconfig_SOURCE_DIR}")
 
-ADD_LIBRARY(suitesparseconfig 
+ADD_LIBRARY(suitesparseconfig STATIC
 	SuiteSparse_config.c
 	SuiteSparse_config.h
 	)

From 96ef883e579591eca2700f6b6359a33f5f18db23 Mon Sep 17 00:00:00 2001
From: xoviat <xoviat@users.noreply.github.com>
Date: Fri, 12 Jan 2018 11:22:07 -0600
Subject: [PATCH 4/5] Allow other LAPACK library names

---
 CMakeLists.txt | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 93ef7d9..97fc308 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -26,6 +26,10 @@ IF(NOT WIN32)
 	SET(GKLIB_PATH "${${PROJECT_NAME}_SOURCE_DIR}/metis/GKlib" CACHE INTERNAL "Path to GKlib (for METIS)" FORCE)
 ENDIF()
 
+IF(WIN32)
+	set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS ON)
+ENDIF()
+
 ## get CMAKE_INSTALL_BINDIR and CMAKE_INSTALL_LIBDIR
 include(GNUInstallDirs)
 
@@ -191,7 +195,7 @@ endif()
 find_package(LAPACK)
 if (LAPACK_FOUND)
 	message(STATUS "found lapack and blas config file. Linking targets lapack and blas")
-	set(SuiteSparse_LINKER_LAPACK_BLAS_LIBS lapack blas)
+	set(SuiteSparse_LINKER_LAPACK_BLAS_LIBS ${LAPACK_LIBRARIES})
 else () # LAPACK is not found
 
 ## Need to use SuiteSparse_LINKER_LAPACK_BLAS_LIBS in our subproject in case of SHARED flag is set to ON

From d84b56490c08adb81c0ef443c6ce0e976c349378 Mon Sep 17 00:00:00 2001
From: xoviat <xoviat@users.noreply.github.com>
Date: Fri, 12 Jan 2018 11:29:12 -0600
Subject: [PATCH 5/5] Explicitly link BLAS

---
 CMakeLists.txt | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 97fc308..2bc34c4 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -192,10 +192,11 @@ if(WITH_CUDA)
 	ENDIF(${CUDA_FOUND})
 endif()
 
+find_package(BLAS)
 find_package(LAPACK)
-if (LAPACK_FOUND)
+if (LAPACK_FOUND AND BLAS_FOUND)
 	message(STATUS "found lapack and blas config file. Linking targets lapack and blas")
-	set(SuiteSparse_LINKER_LAPACK_BLAS_LIBS ${LAPACK_LIBRARIES})
+	set(SuiteSparse_LINKER_LAPACK_BLAS_LIBS ${LAPACK_LIBRARIES} ${BLAS_LIBRARIES})
 else () # LAPACK is not found
 
 ## Need to use SuiteSparse_LINKER_LAPACK_BLAS_LIBS in our subproject in case of SHARED flag is set to ON